<!--
  This template loads for the 'tab.pet-detail' state (app.js)
  'pet' is a $scope variable created in the PetCtrl controller (controllers.js)
  The PetCtrl pulls data from the Pets service (service.js)
  The Pets service returns an array of pet data
-->
<ion-view title="{{friendDetails.friend.facebook.first_name}}">
  <ion-content has-header="true" padding="false">
  <ion-refresher
     on-refresh="onRefresh()"
     >
    </ion-refresher>

  <div class="balance-lcd" ng-class="{loaded: loaded}">
    <p class="balance-text" ng-hide="balance >= 0" ng-cloak>You owe</p>
    <p class="balance-text" ng-hide="balance < 0" ng-cloak>{{friendDetails.friend.facebook.first_name}} owes you</p>
    <span class="balance-number">${{balanceNumber()}}</span>
  </div>
  
  <div class="button-bar no-border">
  	<a class="button" ng-href="/#/lend-stuff/{{friendId}}">Lend Stuff</a>
  	<a class="button" ng-href="/#/lend-money/{{friendId}}">{{paybutton}}</a>
  </div>

 	<div class="list">
    	<div class="item item-divider">You lent to {{friendDetails.friend.facebook.first_name}}</div>
    	<a class="item item-avatar" ng-repeat="item in lentItems = (friendDetails.itemtransactions | filter: lend_filter)" ng-click="openMessages(item._id)">
      		<img ng-src="{{item.items[0].photo_url}}" ng-hide="item.items[0].photo_url.length == 0">
      		<img ng-src="http://{{item.items[0].name}}.jpg.to" ng-hide="item.items[0].photo_url.length > 0" class="item-img">
      		<h2>{{item.items[0].name}}</h2>
        	<p ng-show="item.messages.length === 0">Due {{item.return_date}}</p>
          <p ng-show="item.messages.length > 0">{{item.messages[item.messages.length - 1].content}}</p>
      	</a>

      	<div class="item item-placeholder" ng-show="lentItems.length === 0">
      		<p>Lend something to {{friendDetails.friend.facebook.first_name}}!</p>
      	</div>

    <div class="item item-divider">{{friendDetails.friend.facebook.first_name}} lent to you</div>
    	<a class="item item-avatar" ng-repeat="item in borrowedItems = (friendDetails.itemtransactions | filter: borrow_filter)" ng-click="openMessages(item._id)">
      		<img ng-src="{{item.items[0].photo_url}}" ng-hide="item.items[0].photo_url.length == 0">
      		<img ng-src="http://{{item.items[0].name}}.jpg.to" ng-hide="item.items[0].photo_url.length > 0" class="item-img">
      		<h2>{{item.items[0].name}}</h2>
          <p ng-show="item.messages.length === 0">Due {{item.return_date}}</p>
          <p ng-show="item.messages.length > 0">{{item.messages[item.messages.length - 1].content}}</p>
      	</a>
        <div class="item item-placeholder" ng-show="borrowedItems.length === 0">
          <p>Nothing borrowed from {{friendDetails.friend.facebook.first_name}}</p>
        </div>
    </div>
  </ion-content>
</ion-view>
